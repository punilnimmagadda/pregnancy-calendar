@let appState = appState$ | async;
@let pregnancySummary = pregnancySummary$ | async;
@let pregnancyDays = pregnancyDays$ | async;
<div class="app" [class]="'theme-' + appState?.preferences?.themeColor">
  <!-- Application Header -->
  <app-header
    [preferences]="appState?.preferences ?? null"
    (themeColorChange)="onThemeColorChange($event)"
    (preferencesReset)="onPreferencesReset()"
  ></app-header>

  <!-- Main Content Area -->
  <main class="app__main" role="main">
    <!-- Loading State -->
    <div
      *ngIf="appState?.isLoading"
      class="app__loading"
      role="status"
      aria-label="Loading pregnancy calendar data"
    >
      <div class="loading loading--overlay"></div>
    </div>

    <!-- Setup View (First Time User) -->
    <app-setup
      *ngIf="!appState?.isInitialized && !appState?.isLoading"
      (setupComplete)="onSetupComplete($event)"
    ></app-setup>

    <!-- Main Application Views -->
    <div *ngIf="appState?.isInitialized && !appState?.isLoading" class="app__content">
      <!-- Summary View -->
      <app-summary-view
        *ngIf="appState?.currentView === 'summary'"
        [summary]="pregnancySummary"
        [preferences]="appState?.preferences ?? null"
        class="app__view app__view--summary fade-in"
      ></app-summary-view>

      <!-- Table View -->
      <app-table-view
        *ngIf="appState?.currentView === 'table'"
        [pregnancyDays]="pregnancyDays"
        [preferences]="appState?.preferences ?? null"
        class="app__view app__view--table fade-in"
      ></app-table-view>
    </div>

    <!-- Error State -->
    <div *ngIf="appState?.error" class="app__error" role="alert" aria-live="assertive">
      <div class="card card--elevated">
        <div class="card__header">
          <h2 class="card__title text--error">Something went wrong</h2>
        </div>
        <div class="card__body">
          <p class="text--secondary">{{ appState?.error }}</p>
          <button class="btn btn--primary mt--md" (click)="onRetry()" type="button">
            Try Again
          </button>
        </div>
      </div>
    </div>
  </main>

  <!-- Floating Navigation (shown only when initialized) -->
  <app-floating-navigation
    *ngIf="appState?.isInitialized && !appState?.isLoading"
    [currentView]="appState?.currentView || 'summary'"
    [pregnancyDays]="pregnancyDays"
    [summary]="pregnancySummary"
    [preferences]="appState?.preferences ?? null"
    (viewChange)="onViewChange($event)"
    (exportRequested)="onExportRequested($event)"
    class="app__floating-nav"
  ></app-floating-navigation>

  <!-- Accessibility announcements -->
  <div class="sr-only" role="status" aria-live="polite" aria-atomic="true" #announcements></div>
</div>
